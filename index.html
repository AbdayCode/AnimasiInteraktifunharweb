<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Video Edukasi Interaktif Agama</title>
<style>
    :root{
        --primary:#007bff;
        --accent1:#00c6ff;
        --accent2:#0072ff;
        --glass-bg: rgba(0,0,0,0.38);
    }

    html,body{
        height:100%;
        margin:0;
        font-family: Arial, sans-serif;
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
        background-image: url('https://png.pngtree.com/thumb_back/fh260/background/20240402/pngtree-back-to-school-theme-on-education-image_15647801.jpg');
        background-repeat: repeat;
        background-position: center top;
        background-size: 500px 500px;
        background-attachment: fixed; /* akan diubah ke scroll pada layar kecil via media query */
        color:#111;
        text-align:center;
    }

    /* progress bar */
    #progress-bar{
        position:fixed;
        top:0;
        left:0;
        height:5px;
        width:0%;
        background: linear-gradient(90deg,var(--accent1),var(--accent2));
        z-index:1200;
        transition: width 0.2s linear;
    }

    .page{
        min-height:100vh;
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:flex-start;
        padding:20px 16px 40px 16px;
        box-sizing:border-box;
    }

    /* Judul dengan glass blur (fallback warna) */
    h2.site-title{
        color: #fff;
        font-size: clamp(18px, 3.2vw, 30px);
        font-weight:700;
        margin:18px 0;
        padding:10px 18px;
        background: var(--glass-bg);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        display:inline-block;
        border-radius:10px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.35);
        animation: fadeZoom 1s ease both;
    }

    @keyframes fadeZoom {
        from { opacity:0; transform: translateY(-6px) scale(.98); }
        to   { opacity:1; transform: translateY(0) scale(1); }
    }

    /* video container responsive */
    .video-container{
        position:relative;
        width: min(420px, 92vw);
        aspect-ratio: 9 / 16;
        max-width: 420px;
        margin: 10px auto;
        background: #000;
        border-radius: 12px;
        overflow:hidden;
        border:2px solid rgba(0,0,0,0.6);
        box-shadow: 0 12px 30px rgba(0,0,0,0.45);
    }
    .video-container video{
        width:100%;
        height:100%;
        object-fit:cover;
        display:block;
    }

    /* dark overlay behind modal */
    #overlay{
        position:fixed;
        inset:0;
        background: rgba(0,0,0,0.34);
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
        z-index:1100;
        display:none;
    }

    /* popup question & score */
    .modal {
        position:absolute;
        left:50%;
        top:50%;
        transform: translate(-50%,-50%);
        width: clamp(260px, 86%, 420px);
        max-height: calc(100vh - 80px);
        overflow:auto;
        background: rgba(255,255,255,0.96);
        border-radius: 12px;
        padding: 16px;
        box-sizing:border-box;
        border: 2px solid rgba(0,0,0,0.18);
        box-shadow: 0 8px 24px rgba(0,0,0,0.35);
        z-index: 1150;
        display:none;
        text-align:center;
    }

    .modal h3 { margin: 6px 0 12px 0; font-size: clamp(16px, 2.6vw, 20px); }
    #q-buttons {
        display:grid;
        grid-template-columns: repeat(3, 1fr);
        gap:10px;
        margin-top:6px;
    }

    /* tombol */
    button {
        padding:10px 12px;
        font-size:14px;
        border-radius:8px;
        border: none;
        cursor:pointer;
        background: var(--primary);
        color:#fff;
        box-shadow: 0 6px 18px rgba(0,123,255,0.22);
        transition: transform .12s ease, box-shadow .12s ease;
        min-height:44px;
    }
    button:active { transform: translateY(1px) scale(.998); }
    button:hover { box-shadow: 0 10px 28px rgba(0,123,255,0.32); }

    .correct { background:#28a745 !important; box-shadow: 0 8px 22px rgba(40,167,69,0.18) !important; }
    .wrong   { background:#dc3545 !important; box-shadow: 0 8px 22px rgba(220,53,69,0.18) !important; }

    #answer-feedback{ margin-top:10px; font-weight:700; display:none; font-size:16px; }

    /* score box tweaks */
    #score-box h2 { margin:0 0 8px 0; font-size:20px; }
    #score-box p { margin:0 0 12px 0; font-weight:600; }

    /* responsive adjustments (mobile) */
    @media (max-width:720px){
        body { background-attachment: scroll; background-size: 380px 380px; } /* disable fixed on small screens */
        #q-buttons { grid-template-columns: repeat(1, 1fr); }
        button { font-size:16px; padding:12px; min-height:48px; }
        .modal { padding:14px; }
    }

    /* safety for very small screens */
    @media (max-width:420px){
        .video-container { border-radius:10px; }
        h2.site-title { padding:8px 12px; font-size:18px; }
    }

    /* small helper to hide overflow on body while modal open */
    body.locked { overflow:hidden; touch-action:none; }

</style>
</head>
<body>

<div id="progress-bar"></div>

<div class="page">
    <h2 class="site-title">Video Edukasi Interaktif Agama</h2>

    <div class="video-container" aria-hidden="false">
        <video id="myVideo" playsinline controls preload="metadata">
            <source src="SKRIPSU(1).mp4" type="video/mp4">
            Browser kamu tidak mendukung video.
        </video>

        <!-- overlay + modals (posisikan di atas video) -->
        <div id="overlay" aria-hidden="true"></div>

        <div id="question-box" class="modal" role="dialog" aria-modal="true" aria-labelledby="q-text" tabindex="-1">
            <h3 id="q-text">Pertanyaan muncul di sini</h3>
            <div id="q-buttons" aria-live="polite"></div>
            <div id="answer-feedback" role="status"></div>
        </div>

        <div id="score-box" class="modal" role="dialog" aria-modal="true" tabindex="-1">
            <h2>ðŸŽ¯ Nilai Akhir</h2>
            <p id="final-score">Nilai kamu: 0</p>
            <button id="restart-btn">Ulangi</button>
        </div>
    </div>
</div>

<!-- suara -->
<audio id="sound-pop" src="POP.mp3" preload="auto"></audio>
<audio id="sound-correct" src="CORRECT.mp3" preload="auto"></audio>
<audio id="sound-wrong" src="WRONG.mp3" preload="auto"></audio>

<!-- confetti library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* ====== ELEMENTS ====== */
const video = document.getElementById('myVideo');
const questionBox = document.getElementById('question-box');
const qText = document.getElementById('q-text');
const qButtons = document.getElementById('q-buttons');
const scoreBox = document.getElementById('score-box');
const finalScore = document.getElementById('final-score');
const overlay = document.getElementById('overlay');
const restartBtn = document.getElementById('restart-btn');

const soundPop = document.getElementById('sound-pop');
const soundCorrect = document.getElementById('sound-correct');
const soundWrong = document.getElementById('sound-wrong');

let score = 0;
const POINTS = 10;
let isQuestionActive = false;
let shownQuestions = new Set();

/* ====== QUESTIONS (sesuaikan waktu detik) ====== */
let questions = [
    { time:15, text: "Hari ini kita belajar tentang?", answers:[
        {text:"Toleransi", correct:true},
        {text:"Main", correct:false},
        {text:"Masak", correct:false}
    ]},
    { time:27, text: "Andi beragama apa?", answers:[
        {text:"Islam", correct:true},
        {text:"Kristen", correct:false},
        {text:"Budda", correct:false}
    ]},
    { time:32, text: "Lala beragama apa?", answers:[
        {text:"Islam", correct:false},
        {text:"Kristen", correct:false},
        {text:"Konghucu", correct:true}
    ]},
    { time:37, text: "Josep beragama apa?", answers:[
        {text:"Islam", correct:false},
        {text:"Kristen", correct:true},
        {text:"Konghucu", correct:false}
    ]},
    { time:42, text: "Matthew beragama apa?", answers:[
        {text:"Hindu", correct:false},
        {text:"Buddha", correct:true},
        {text:"Konghucu", correct:false}
    ]},
    { time:48, text: "Alex beragama apa ?", answers:[
        {text:"Hindu", correct:true},
        {text:"Buddha", correct:false},
        {text:"Konghucu", correct:false}
    ]}
];

/* ====== HELPERS ====== */
function showOverlay(show=true){
    overlay.style.display = show ? 'block' : 'none';
    overlay.setAttribute('aria-hidden', show ? 'false' : 'true');
}

function lockPage(lock=true){
    document.body.classList.toggle('locked', lock);
}

/* play sound safely (catch promise rejections on mobile autoplay rules) */
function safePlay(audioEl){
    if(!audioEl) return;
    try{
        const p = audioEl.play();
        if(p && p.catch) p.catch(()=>{/* ignore autoplay block */});
    }catch(e){}
}

/* confetti */
function confettiEffect(){
    try{
        confetti({ particleCount: 90, spread: 65, origin: { y: 0.6 } });
    }catch(e){}
}

/* ====== VIDEO & PROGRESSBAR ====== */
const progressBar = document.getElementById('progress-bar');
video.addEventListener('timeupdate', () => {
    if(video.duration){
        const percent = (video.currentTime / video.duration) * 100;
        progressBar.style.width = percent + '%';
    }
    // show questions at exact second
    const currentSec = Math.floor(video.currentTime);
    questions.forEach(q => {
        if(!shownQuestions.has(q.time) && currentSec === q.time){
            shownQuestions.add(q.time);
            // small timeout to ensure UI ready
            setTimeout(()=> showQuestion(q), 80);
        }
    });
});

/* prevent seeking while question active */
video.addEventListener('seeking', (e) => {
    if(isQuestionActive){
        e.preventDefault();
        // keep video at locked time if available
        if(video.dataset.lockTime) video.currentTime = Number(video.dataset.lockTime);
    }
});

/* if video ends, show final score */
video.addEventListener('ended', () => showFinalScore());

/* ====== SHOW / HIDE QUESTION ====== */
function showQuestion(q){
    isQuestionActive = true;
    // pause video, remove controls (so native controls hidden)
    video.pause();
    video.removeAttribute('controls');
    video.dataset.lockTime = q.time;

    // prepare modal
    qText.textContent = q.text;
    qButtons.innerHTML = '';
    document.getElementById('answer-feedback').style.display = 'none';

    // create buttons (grid)
    q.answers.forEach(ans => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = ans.text;
        btn.onclick = () => checkAnswer(btn, ans.correct);
        qButtons.appendChild(btn);
    });

    // show overlay + modal
    showOverlay(true);
    questionBox.style.display = 'block';
    questionBox.focus && questionBox.focus();
    questionBox.scrollTop = 0;

    lockPage(true);

    // play pop sound (safely)
    safePlay(soundPop);
}

/* ====== ANSWER CHECK ====== */
function checkAnswer(button, isCorrect){
    const feedbackEl = document.getElementById('answer-feedback');
    // disable all
    Array.from(qButtons.querySelectorAll('button')).forEach(b => b.disabled = true);

    if(isCorrect){
        score += POINTS;
        button.classList.add('correct');
        safePlay(soundCorrect);
        feedbackEl.textContent = 'Benar!';
        feedbackEl.style.display = 'block';
        feedbackEl.className = 'correct-text';
        confettiEffect();
    } else {
        button.classList.add('wrong');
        safePlay(soundWrong);
        feedbackEl.textContent = 'Salah!';
        feedbackEl.style.display = 'block';
        feedbackEl.className = 'wrong-text';
    }

    // after delay, hide modal and resume
    setTimeout(()=> {
        questionBox.style.display = 'none';
        showOverlay(false);
        video.setAttribute('controls', 'true');
        isQuestionActive = false;
        lockPage(false);
        // try to resume playback (safely)
        try{ video.play().catch(()=>{}); }catch(e){}
    }, 2200);
}

/* ====== FINAL SCORE & RESTART ====== */
function showFinalScore(){
    finalScore.textContent = `Nilai kamu: ${score} / ${questions.length * POINTS}`;
    scoreBox.style.display = 'block';
    showOverlay(true);
    lockPage(true);
}

restartBtn.addEventListener('click', ()=> {
    // reset
    score = 0;
    shownQuestions.clear();
    scoreBox.style.display = 'none';
    showOverlay(false);
    lockPage(false);
    video.currentTime = 0;
    // ensure controls back
    video.setAttribute('controls','true');
    try { video.play().catch(()=>{}); }catch(e){}
});

/* Prevent accidental touch-scroll on overlay (small screens) */
overlay.addEventListener('touchmove', function(e){ e.preventDefault(); }, { passive:false });

/* accessibility: close modals on escape */
document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
        if(questionBox.style.display === 'block'){
            // emulate skipping (hide modal and resume)
            questionBox.style.display = 'none';
            showOverlay(false);
            video.setAttribute('controls','true');
            isQuestionActive = false;
            lockPage(false);
            try{ video.play().catch(()=>{}); }catch(e){}
        } else if(scoreBox.style.display === 'block'){
            scoreBox.style.display = 'none';
            showOverlay(false);
            lockPage(false);
        }
    }
});
</script>
</body>
</html>
    
