<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pembelajaran Agama</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-image: url('https://i.pinimg.com/564x/2e/83/5d/2e835d860fe308819dc649bf829a8a12.jpg');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            position: relative;
        }
        .container-box {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            overflow-x: auto;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <audio id="background-audio" loop>
        <source src="bg.mp3" type="audio/mpeg">
        Maaf, browser Anda tidak mendukung audio.
    </audio>

    <audio id="click-audio" src="click.mp3" preload="auto"></audio>

    <div id="main-menu" class="container-box text-center">
        <h2 class="mb-4 text-dark">Materi Pembelajaran Agama</h2>
        <div class="d-grid gap-3">
            <button id="show-login-btn" class="btn btn-primary">Login</button>
            <button id="show-register-btn" class="btn btn-outline-primary">Buat Akun</button>
        </div>
    </div>

    <div id="login-form" class="container-box hidden">
        <h2 class="text-center mb-4">Login Pengguna</h2>
        <form id="loginForm">
            <div class="mb-3">
                <label for="namaLogin" class="form-label">Nama Lengkap</label>
                <input type="text" class="form-control" id="namaLogin" required>
            </div>
            <div class="mb-3">
                <label for="passwordLogin" class="form-label">Kata Sandi</label>
                <input type="password" class="form-control" id="passwordLogin" required>
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">Masuk</button>
                <button type="button" id="back-login" class="btn btn-link">Kembali</button>
            </div>
        </form>
    </div>

    <div id="register-form" class="container-box hidden">
        <h2 class="text-center mb-4">Buat Akun Baru</h2>
        <form id="registerForm">
            <div class="mb-3">
                <label for="namaRegister" class="form-label">Nama Lengkap</label>
                <input type="text" class="form-control" id="namaRegister" required>
            </div>
            <div class="mb-3">
                <label for="passwordRegister" class="form-label">Kata Sandi</label>
                <input type="password" class="form-control" id="passwordRegister" required>
            </div>
            <div class="mb-3">
                <label for="kelas" class="form-label">Kelas</label>
                <select class="form-select" id="kelas" required>
                    <option value="">Pilih Kelas</option>
                    <option value="3A">3A</option>
                    <option value="3B">3B</option>
                    <option value="3C">3C</option>
                </select>
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">Daftar</button>
                <button type="button" id="back-register" class="btn btn-link">Kembali</button>
            </div>
        </form>
    </div>

    <div id="admin-menu" class="container-box text-center hidden">
        <h2 class="mb-4 text-dark">Selamat Datang, Admin</h2>
        <p class="lead">Anda telah berhasil masuk ke menu administrator.</p>
        <div class="d-grid gap-3">
            <button id="show-user-data-btn" class="btn btn-info text-white">Lihat Data Pengguna</button>
            <button id="delete-all-data-btn" class="btn btn-warning text-dark">Hapus Semua Data Pengguna</button>
            <button id="logout-admin-btn" class="btn btn-danger">Logout</button>
        </div>
    </div>

    <div id="user-data-admin" class="container-box hidden">
        <h2 class="text-center mb-4">Data Pengguna dan Nilai Kuis</h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Nama</th>
                        <th>Kata Sandi</th>
                        <th>Kelas</th>
                        <th>Nilai Kuis</th>
                    </tr>
                </thead>
                <tbody id="user-scores-table-body">
                    </tbody>
            </table>
        </div>
        <div class="text-center mt-4">
            <button id="back-from-data-btn" class="btn btn-secondary">Kembali</button>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainMenu = document.getElementById('main-menu');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const adminMenu = document.getElementById('admin-menu');
            const userDataAdmin = document.getElementById('user-data-admin');
            const userScoresTableBody = document.getElementById('user-scores-table-body');
            const backgroundAudio = document.getElementById('background-audio');
            const clickAudio = document.getElementById('click-audio');

            const showLoginBtn = document.getElementById('show-login-btn');
            const showRegisterBtn = document.getElementById('show-register-btn');
            const backLoginBtn = document.getElementById('back-login');
            const backRegisterBtn = document.getElementById('back-register');
            const backFromDataBtn = document.getElementById('back-from-data-btn');
            const showUserDataBtn = document.getElementById('show-user-data-btn');
            const deleteAllDataBtn = document.getElementById('delete-all-data-btn');
            const logoutAdminBtn = document.getElementById('logout-admin-btn');
            
            const loginFormElement = document.getElementById('loginForm');
            const registerFormElement = document.getElementById('registerForm');
            
            // Tampilkan menu utama saat halaman dimuat
            mainMenu.classList.remove('hidden');

            function hideAllForms() {
                mainMenu.classList.add('hidden');
                loginForm.classList.add('hidden');
                registerForm.classList.add('hidden');
                adminMenu.classList.add('hidden');
                userDataAdmin.classList.add('hidden');
            }

            function playAudio() {
                backgroundAudio.play().catch(error => {
                    console.log("Audio play was prevented:", error);
                });
            }

            function playClickSound() {
                clickAudio.currentTime = 0;
                clickAudio.play();
            }

            // Tambahkan event listener untuk suara klik ke semua tombol
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', playClickSound);
            });

            showLoginBtn.addEventListener('click', () => {
                hideAllForms();
                loginForm.classList.remove('hidden');
            });

            showRegisterBtn.addEventListener('click', () => {
                hideAllForms();
                registerForm.classList.remove('hidden');
            });

            backLoginBtn.addEventListener('click', () => {
                hideAllForms();
                mainMenu.classList.remove('hidden');
            });

            backRegisterBtn.addEventListener('click', () => {
                hideAllForms();
                mainMenu.classList.remove('hidden');
            });

            loginFormElement.addEventListener('submit', function(event) {
                event.preventDefault();
                const namaLogin = document.getElementById('namaLogin').value;
                const passwordLogin = document.getElementById('passwordLogin').value;

                if (namaLogin.toLowerCase() === 'admin' && passwordLogin === 'admin123') {
                    // Login sebagai admin
                    hideAllForms();
                    adminMenu.classList.remove('hidden');
                    return;
                }

                const userData = JSON.parse(localStorage.getItem(namaLogin));

                if (userData && userData.password === passwordLogin) {
                    localStorage.setItem('namaPengguna', namaLogin);
                    localStorage.setItem('kelasPengguna', userData.kelas);
                    window.location.href = 'halaman_utama.html';
                } else {
                    alert('Nama atau kata sandi salah. Silakan coba lagi.');
                }
            });

            registerFormElement.addEventListener('submit', function(event) {
                event.preventDefault();
                const namaRegister = document.getElementById('namaRegister').value;
                const passwordRegister = document.getElementById('passwordRegister').value;
                const kelas = document.getElementById('kelas').value;

                if (localStorage.getItem(namaRegister)) {
                    alert('Nama pengguna sudah terdaftar. Silakan gunakan nama lain.');
                    return;
                }

                const userData = {
                    password: passwordRegister,
                    kelas: kelas
                };
                localStorage.setItem(namaRegister, JSON.stringify(userData));
                
                alert('Akun berhasil dibuat! Silakan login.');
                hideAllForms();
                loginForm.classList.remove('hidden');
            });

            showUserDataBtn.addEventListener('click', () => {
                hideAllForms();
                userDataAdmin.classList.remove('hidden');
                displayUserScores();
            });

            backFromDataBtn.addEventListener('click', () => {
                hideAllForms();
                adminMenu.classList.remove('hidden');
            });

            deleteAllDataBtn.addEventListener('click', () => {
                if (confirm('Apakah Anda yakin ingin menghapus semua data pengguna? Tindakan ini tidak dapat dibatalkan.')) {
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        // Hapus semua data yang bukan admin
                        if (key !== 'namaPengguna' && key !== 'kelasPengguna' && key !== 'admin') {
                            keysToRemove.push(key);
                        }
                    }
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    alert('Semua data pengguna berhasil dihapus!');
                    hideAllForms();
                    mainMenu.classList.remove('hidden');
                }
            });

            logoutAdminBtn.addEventListener('click', () => {
                hideAllForms();
                mainMenu.classList.remove('hidden');
            });

            function displayUserScores() {
                userScoresTableBody.innerHTML = '';
                const users = [];
                const subjects = ['islam', 'kristen', 'katolik', 'hindu', 'buddha', 'konghucu'];

                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    try {
                        const userData = JSON.parse(localStorage.getItem(key));
                        if (userData && userData.password && userData.kelas) {
                            users.push({
                                name: key,
                                ...userData
                            });
                        }
                    } catch (e) {
                        // Abaikan data yang bukan JSON (misalnya skor kuis)
                    }
                }

                users.forEach(user => {
                    const scores = {};
                    subjects.forEach(subject => {
                        const scoreKey = `${user.name}_${subject}Score`;
                        scores[subject] = localStorage.getItem(scoreKey) || 'Belum Mengerjakan';
                    });

                    const scoreString = Object.entries(scores)
                        .map(([subject, score]) => `<span class="badge bg-secondary me-1">${subject.charAt(0).toUpperCase() + subject.slice(1)}: ${score}</span>`)
                        .join(' ');
                    
                    const row = `
                        <tr>
                            <td>${user.name}</td>
                            <td>${user.password}</td>
                            <td>${user.kelas}</td>
                            <td>${scoreString}</td>
                        </tr>
                    `;
                    userScoresTableBody.innerHTML += row;
                });

                if (users.length === 0) {
                    userScoresTableBody.innerHTML = `<tr><td colspan="4" class="text-center text-muted">Belum ada pengguna terdaftar.</td></tr>`;
                }
            }

            // Atur pemutaran audio saat pengguna berinteraksi
            document.addEventListener('click', playAudio, { once: true });
        });
    </script>
</body>
</html>